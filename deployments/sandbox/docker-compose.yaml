version: '3.8'

services:
  sandbox:
    build: .
    image: sandbox:latest
    container_name: sandbox
    network_mode: none                      # no network by default
    read_only: true                          # rootfs read-only
    tmpfs:
      - /tmp:rw,exec                         # writable tmp
      - /run:rw                              # writable runtime dir
    pids_limit: 128                          # limit processes
    cpus: 1.0                                # cpu share
    mem_limit: 1g                            # memory cap
    security_opt:
      - no-new-privileges:true               # no setuid
      - seccomp:./seccomp.json          # provide seccomp profile
    cap_drop:
      - ALL                                  # drop all capabilities
    volumes:
      - ai-workspace:/home/sandbox/persistent:rw  # persistent workspace (human-managed)
      - ./workspace:/home/sandbox/workspace:rw     # temporary sandbox workspace
    restart: unless-stopped                  # keep it running
    # Note: persistent workspace contains datasets and files managed by humans
    #       temporary workspace is for sandbox operations and can be reset

volumes:
  ai-workspace:
    driver: rclone
    driver_opts:
      type: "webdav"
      webdav_url: "http://localhost:4001"
      webdav_vendor: "other"
      webdav_user: "admin"
      webdav_pass: "LACyVhZAkys-312NHJJrUobWhYky"
      allow_other: "true"
      path: "personal-server/ai-workspace"
      vfs_cache_mode: "writes"
      poll_interval: "30s"